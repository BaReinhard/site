---
layout: default
classname: map

stylesheets:
  - "https://api.mapbox.com/mapbox.js/v3.0.1/mapbox.css"
---

{% assign form_action = page.first %}

{% include search-form.html %}

<div id="map" class="mapbox" style="margin-top: 1.5em;"></div>

<!--
<div id="map-not-supported-message" class="message" style="display: none; position: absolute; bottom: 0; left: 0; width: 100%; z-index: 1; padding: 1.5em; text-align: center; background: white; z-index: 9999; box-sizing: border-box;">
	<h1 style="margin-top: 0;">Uh oh!</h1>
	<p style="max-width: none;">Our map isn’t working in this web browser. You may want to try viewing the <a href="/list">list of locations</a> instead.</p>
	<p style="max-width: none;" class="action"><a href="/list">Show me the list</a></p>
</div>
-->

<!-- For map.js -->
<script type="text/template" id="you-are-here-template">
	<div class="you-are-here"><span>You are here</span></div>
</script>

<!--
<script type="text/template" id="marker-template">
	<div class="marker">
		<img src="/assets/images/markers/purple.svg" alt="" />
	</div>
</script>
-->

<script type="text/template" id="popup-template">
	<div class="map-point-details">
		<h3><a href=""></a></h3>
		<p class="type"></p>
		<p class="address"></p>
		<p class="phone"></p>
		<h4>Hours</h4>
		<p class="hours"></p>
		<p class="distance"><span></span> miles away</p>
	</div>
</script>

<script type="text/template" id="list-item-template">
	<a href="">
		<h2></h2>
		<p class="type"></p>
		<p class="address"></p>
		<h3>Hours</h3>
		<p class="hours"></p>
		<p class="distance"><span></span> miles away</p>
	</a>
</script>

<ul class="food-source-list">
{% if page.collection %}

	{% assign data_collection = site.collections | where: "label", page.collection | first %}
	{% assign data_list = data_collection.docs %}
	{% assign list_limit = page.items_per_page %}
	{% assign list_offset = page.list_offset %}
	{% include list.html %}

{% else %}

	{% assign data_list = site.data['generated-locations-for-jekyll'] %}

{% comment %}
	<h1>community_gardens: {{ community_gardens }}</h1>
	<h1>farmers_markets: {{ farmers_markets }}</h1>
	<h1>food_pantries: {{ food_pantries }}</h1>
{% endcomment %}

	{% assign list_limit = page.items_per_page %}
	{% assign list_offset = page.list_offset %}
	{% include list.html %}

{% endif %}
</ul>

{% if page.next or page.previous %}
<nav class="pagination">
	<ul>
		{% if page.next %}
		<li><a href="{{ page.next }}">More Locations</a></li>
		{% endif %}
{% comment %}
		{% if page.previous %}
		<li><a href="{{ page.previous }}">Previous Page</a></li>
		{% endif %}
{% endcomment %}
	</ul>
</nav>
<script>
(function() {

	// http://stackoverflow.com/questions/901115/how-can-i-get-query-string-values-in-javascript#answer-901144	
	function getParameterByName(name, url) {
		if (!url) url = window.location.href;
		name = name.replace(/[\[\]]/g, "\\$&");
		var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
				results = regex.exec(url);
		if (!results) return null;
		if (!results[2]) return '';
		return decodeURIComponent(results[2].replace(/\+/g, " "));
	}

	// SHIM: Make the address persistent
	var paginationLink = document.querySelector('.pagination a[href]');
	var address = getParameterByName('address');
	if (address) {
		var href = paginationLink.getAttribute('href');
		href += '?address=' + address;
		paginationLink.setAttribute('href', href);
	}
})();
</script>
{% endif %}

<!-- Jim’s Google Maps API key -->
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBP5KxqO9v1sLhXlkrG3vDiDdOJvYLJ0H4"></script>

<script src='https://api.mapbox.com/mapbox.js/v3.0.1/mapbox.js'></script>

<script>
var MAP_ACCESS_TOKEN = 'pk.eyJ1IjoiZm9vZG9hc2lzbGEiLCJhIjoiY2l0ZjdudnN4MDhpYzJvbXlpb3IyOHg2OSJ9.POBdqXF5EIsGwfEzCm8Y3Q';
</script>

<script>
var listOffset = {{ page.list_offset }};
</script>

{% if page.collection %}
<script src="/api/{{ page.collection }}.js"></script>
{% else %}
<script src="/api/locations.js"></script>
{% endif %}

<script src="/assets/js/map.js"></script>
